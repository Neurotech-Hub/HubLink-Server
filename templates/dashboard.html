{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 p-5 bg-light rounded shadow-sm">
    <h1 class="text-center mb-4">{{ account.name }}</h1>

    <ul class="nav nav-tabs" id="accountTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link {% if not request.args.get('tab') or request.args.get('tab') != 'data' %}active{% endif %}"
                id="settings-tab" data-toggle="tab" href="#settings" role="tab" aria-controls="settings"
                aria-selected="true">Settings</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if request.args.get('tab') == 'data' %}active{% endif %}" id="data-tab"
                data-toggle="tab" href="#data" role="tab" aria-controls="data" aria-selected="false">Data</a>
        </li>
    </ul>

    <div class="tab-content mt-4" id="accountTabContent">
        <div class="tab-pane fade {% if not request.args.get('tab') or request.args.get('tab') != 'data' %}show active{% endif %}"
            id="settings" role="tabpanel" aria-labelledby="settings-tab">
            <p><strong>Secret URL:</strong> <a
                    href="{{ url_for('account_dashboard', account_url=account.url, _external=True) }}">{{
                    url_for('account_dashboard', account_url=account.url, _external=True) }}</a></p>

            <form action="/update/{{ account.id }}" method="POST" class="mt-4">
                <div class="form-group mb-4">
                    <label for="s3_api_key" class="font-weight-bold">S3 API Key:</label>
                    <input type="text" id="s3_api_key" name="s3_api_key" class="form-control border border-secondary"
                        value="{{ settings.s3_api_key }}">
                </div>

                <div class="form-group">
                    <label for="bucket_name">S3 Bucket Name:</label>
                    <input type="text" id="bucket_name" name="bucket_name" class="form-control"
                        value="{{ settings.bucket_name }}">
                </div>

                <div class="form-group">
                    <label for="dt_rule">Datetime Rule:</label>
                    <select id="dt_rule" name="dt_rule" class="form-control border border-secondary">
                        <option value="seconds" {% if settings.dt_rule=='seconds' %}selected{% endif %}>Seconds
                            (YYYYMMDDHHMMSS)</option>
                        <option value="hours" {% if settings.dt_rule=='hours' %}selected{% endif %}>Hours (YYYYMMDDHH)
                        </option>
                        <option value="days" {% if settings.dt_rule=='days' %}selected{% endif %}>Days (YYYYMMDD)
                        </option>
                        <option value="weeks" {% if settings.dt_rule=='weeks' %}selected{% endif %}>Weeks (YYYYWW)
                        </option>
                        <option value="months" {% if settings.dt_rule=='months' %}selected{% endif %}>Months (YYYYMM)
                        </option>
                        <option value="years" {% if settings.dt_rule=='years' %}selected{% endif %}>Years (YYYY)
                        </option>
                        <option value="never" {% if settings.dt_rule=='never' %}selected{% endif %}>Never</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_file_size">Max File Size (bytes):</label>
                    <input type="number" id="max_file_size" name="max_file_size" class="form-control"
                        value="{{ settings.max_file_size }}" required>
                </div>

                <div class="form-group">
                    <label for="use_cloud">Use/Upload to Cloud:</label>
                    <select id="use_cloud" name="use_cloud" class="form-control">
                        <option value="true" {% if settings.use_cloud %}selected{% endif %}>True</option>
                        <option value="false" {% if not settings.use_cloud %}selected{% endif %}>False</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="delete_scans">Delete Scans from Hub:</label>
                    <select id="delete_scans" name="delete_scans" class="form-control">
                        <option value="true" {% if settings.delete_scans %}selected{% endif %}>True</option>
                        <option value="false" {% if not settings.delete_scans %}selected{% endif %}>False</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="delete_scans_days_old">Delete Scans Older Than (days):</label>
                    <input type="number" id="delete_scans_days_old" name="delete_scans_days_old" class="form-control"
                        value="{{ settings.delete_scans_days_old }}">
                </div>

                <div class="form-group">
                    <label for="delete_scans_percent_remaining">Delete Scans Percent Remaining:</label>
                    <input type="number" id="delete_scans_percent_remaining" name="delete_scans_percent_remaining"
                        class="form-control" value="{{ settings.delete_scans_percent_remaining }}">
                </div>

                <div class="form-group">
                    <label for="device_name_includes">Device Filter by Name:</label>
                    <input type="text" id="device_name_includes" name="device_name_includes" class="form-control"
                        value="{{ settings.device_name_includes }}">
                </div>

                <div class="form-group">
                    <label for="id_file_starts_with">Override MAC with ID File (Starts With):</label>
                    <input type="text" id="id_file_starts_with" name="id_file_starts_with" class="form-control"
                        value="{{ settings.id_file_starts_with }}">
                </div>

                <div class="form-group">
                    <label for="alert_email">Alert Email:</label>
                    <input type="email" id="alert_email" name="alert_email" class="form-control"
                        value="{{ settings.alert_email }}">
                </div>

                <div class="text-center">
            </form>
            <button type="submit" class="btn btn-success mt-3 mr-2 shadow-sm px-4">Update Settings</button>
            <form action="/delete/{{ account.id }}" method="POST" class="d-inline"
                onsubmit="return confirm('Are you sure you want to delete this account?');">
                <button type="submit" class="btn btn-danger mt-3 shadow-sm px-4">Delete Account</button>
            </form>
        </div>
    </div>

    <div class="tab-pane fade {% if request.args.get('tab') == 'data' %}show active{% endif %}" id="data"
        role="tabpanel" aria-labelledby="data-tab">
        <h3>Recent Data</h3>
        {% if recent_files %}
        <ul class="list-group">
            {% for file in recent_files %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="{{ file.url }}" download>{{ file.name }}</a>
                <span class="badge badge-primary badge-pill">{{ file.size }} bytes</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No recent data available.</p>
        {% endif %}
    </div>
</div>
</div>
{% endblock %}